---
layout: post
title: "实时系统"
date: 2017-12-31 16:00:00 +0800
categories: system
tag: [websocket]
---
* content
{:toc}


## 背景
当我们打开某个平台的游览器和APP或者其他客户端的时候， 这个平台是以海量的实时数据支撑的， 也就是我们可以在该平台中实时看到这些新产生的实时数据， 也可以说， 就是平台会将数据准确推给（目标）用户或（目标）群体，并且是实时的。
如何搭建一个可用，可扩展的实时系统， 这是我们今天要探究的主题


<!-- more -->
### 先拿最简单的游览器来说
在访问一个网页时, 如 http://www.baidu.com 我们从地址可以看到， 以http协议向域名为www.baidu.com 的地址取东西， 游览器返回的也是http协议的响应， 可以在响应体中看到html等标签， 这些标签语言会被游览器解析渲染成我们所看到的页面  
这样游览器与服务器就完成了一次数据交互。





### 除去一系列原理， 我们要做什么
大家可能对于http，websocket， 长连接，轮训等概念并不是很感兴趣，没关系， 其实我们更要清楚， 用这些技术我们能做什么， 在一开始中，我提出了这个这个系统的背景， 以图解的形式大致如下： （在这里再强调一下）   




首先来分析一下以下方式：
1. ajax 短轮训获取数据   

    每隔几秒， ajax向服务器获取数据， 服务器每次收到请求， 去查询到的最新的数据返回回去。 
    这种以拉的形式获取数据， 只需要客户端知道服务器数据的所在位置（接口） 就可以获取到数据。  
    
    缺点： 并非完全实时， 如果数据是1秒钟来一次， 而轮训的时间是5秒钟， 那么就会存在4秒的延迟。 提升频率是否能解决问题？ 不好， 频率的上调会使得服务器的压力上升， 尤其是对于并发量大情况下， 服务器的压力是成倍上涨。
    
2. websocket 长连接方式  
    首先上一张图（节选自netty in action)  
![websocket]({{ site.img_blog | prepend: site.baseurl}}/websocket.png)
    
解释： 可以看到首先客户端发送http请求，而服务端收到该请求之后， 知道客户端需要建立websocket， 于是服务端就交给websocket的处理upgrade 