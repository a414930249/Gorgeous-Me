数据采集频率和数据上传频率


1. 数据采集频率即程序从源采集的频率
2. 数据上传频率即数据上传到服务器的频率
3. 数据可视化后数据频率

### 问题背景：
往往数据采集频率与数据上传频率是不一致的， 

首先解释一下为什么要采集频率和上传频率不一样？

1. 我们数据采集可能面临数据采集失败的情况。 如果采集和数据频率相同， 那么在采集的时候如果失败了， 就会出现数据频繁丢失的情况。
2. 往往我们需要对多条采集的数据进行一定的处理才能进行上传 
一次的采集到的数据可能并不是”真实“的数据， 数据可能由于某些原因造成当是的数据远远超出范围， 而其他数据都是正常的， 这时候可能就需要进行滤波



### 数据采集频率不同和上传频率不同所带来的问题
> 数据被采集后的数据存储在哪里？  

#####  存储到内存中

优点： 开发简单， 当结算的时候仅从内存中拿到之前存储的， 进行处理后提交  
缺点： 一旦服务宕机了， 之前存储的数据将会全部丢失

服务宕机是小概率事件， 如果可以容忍， 倒是个不错的选择。   
但是对于一个非常庞大的项目来讲， 服务一定会做好容灾处理， 负载均衡也好， 服务降级也罢， 这就涉及到分布式的问题， 那么存储到的内存也需要是分布式的， 这时候可以考虑分布式缓存，如memcache或者redis 缓存数据库等。

如果考虑到了分布式的问题， 那么内存存储也将不是问题

##### 数据存储介质为时序数据库， 在一定业务场景下可以不进行存储， 采一次提交一次  
对于时序数据库如果不了解可以见我写的/**todo**/， 时序数据库支持降精度及插值的处理， 也就是说我们可以通过一条查询语句， 就可以将数据以一定时间频率按照平均值、最大值等数据处理成一个点。

优点： 不用额外的开发就可以实现大部分业务  
缺点： 应用场景有限， 对于特别数据处理手段将不支持。


##### 定时任务驱动： 通过定时任务将数据从数据库取出结算再入库
还有一种简单的思路： 数据采集一条就上传一条， 也不用什么时序数据库， 数据存入到如mysql这类的数据库中 （这也是我刚来公司的架构）， 通过Quartz定时任务去结算一类设备的数据。



优点： 针对不同的处理算法可以定制化  
缺点： 每个设备的上传时间或频率都可能不相同，只能针对**一类设备**一个定时时间，而同一类设备来的数据时间不同的， 这就造成很多设备数据会被延时处理， 每个设备无法精确到固定频率。 

示意图如下：![image](http://upload.ouliu.net/i/20171207213602aveqf.png)

从中可以看到A设备在定时任务被执行的时候延迟了一段时间， 而B在定时任务被执行时由于没有达到一个频率的时间并没有被结算。  
这就导致很多数据都存在延迟。


> 在允许一定范围内延迟的情况下（比如允许一个数据采集频率时间内）还有一种思路：
#####  数据驱动
数据还是采集一条上传一条， 而针对每次上传的数据先判断该设备是否满足一次结算的时间， 如果不满足直接入库， 若满足则将上一次到本次的数据取出， 结算后入库。

这样的好处： 处理算法可以定制化， 延迟不会过高， 仅一个采集频率时间。   
缺点： 不适合上传频率和采集频率相近的，切采集频率较低的场景。如半小时采集一次。






如果您有更好的想法， 更优的策略， 可以联系我