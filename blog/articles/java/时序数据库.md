# 时序数据库
1. 原始场景
1. 什么是时序数据库
2. 时序数据库的应用场景
3. 时序数据库的优缺点
4. 时序数据库面临的问题
5. opentsdb 存在的问题




1. 在企业中， mysql 作为关系数据库在大大小小的场景中都有应用， 简单的sql， 关联查询，事务支持，丰富的类型等 使得其成为数据持久的利器。在我从事的物联网公司，数据的存储， 最初也是简单的采用了mysql。


## 物联网数据之mysql

物联网的数据主要是通过传感器采集的数据， 经过解析， 清洗， 以结构化的格式进行存储， 但是数据中有一个特点， 那就是每条数据都会带一个时间戳， 代表数据被采集的时间。  
假设数据的格式是这样的:
```
a   b   value1    time1
a   b   value2    time2
a   c   value3    time3

```

对于我们要筛选某段时间很容易写出下列sql：   
```sql
 select * from table where time between  A and B [and other filter condition ]
```
如果我们要查询离某个时间点后最近的一条，可能会写出如下sql：  
```sql
select * from table where time > A  [ and other filter condition ] limit 0,1  
```

可是这么写可能优点问题， 这样默认是根据id进行排序， 而不是时间进行排序， 所以正确的应该是：  
比如当间隔为1年时取每天的平均值作为一个样点， 我们发现可能会这样写
```sql
select * from table where time > A  [ and other filter condition ] order by time asc limit 0,1  
```

在不考虑性能的情况下， 用mysql似乎能满足我们大部分的需求。 

考虑下面一种情况：  假设我们筛选某段时间的间隔很长， 可能几个月， 可能一年，并且， 我们想要将这些点以时间为主轴进行展示， 那么我们可能看到的将会是下面的效果：  
![image](http://chuantu.biz/t6/138/1510482180x2061543562.png)
可以看到， 点是相当密集的。

这时候我们会想， 如何用sql 来降精度， 比如当间隔为1年时取每天的平均值作为一个样点， 我们发现可能会这样写
```sql
 select avg(value), time from table where time between A and B [ and other filter condition ] group by date_format(time, '%m-%d-%Y') order by time asc
```

按照每天的可能好写， 可是按照每小时的该怎么写呢， 以及其他的呢， 我们会发现sql可能已经满足不了我们的要求了。

除此之外， 我们之前一直未考虑一个问题： ==**性能**==

物联网，时时刻刻在产生数据， 如果是传感器， 可能频率短的几秒中， 长的也可能只有数分钟， 这只是1个传感器， 在大量的传感器短时间的会上传大量数据， 久而久之， 这个数据库会有上百万甚至上千万的的数据， 并且历史的数据尤其存在的价值。如未来大数据的离线分析。

如果此时我们再通过这些sql，甚至使用order by， 一条sql可能会相应数秒中甚至数分钟才能相应出来。 

因为对于mysql， 数据之间并没有时间上的概念， 一条记录就是一个点。 对于其要从时间上筛选出点来， 使得查询效率上不尽如意。


添加索引：  
我们发现，时间是一个必加的索引。 而根据哪些条件筛选， 每个字段都有可能成为筛选条件， 这时候， 我们会对除主键意外的字段都加索引， 也就是一个除主键以外的其他字段的联合索引。


但索引的建立， 势必会影响插入的性能。


总的来说， 对于这些在时间序列的点， 使用mysql 总是有些要求满足不了，那么有什么更好的存储介质呢？ 

> **时序数据库** 

作为物联网的利器， 目前使用的越来越广泛， 可以从[这个网站](https://db-engines.com/en/ranking/time+series+dbms)看到各种时序数据库及排名



## 时序数据库

### 什么是时序数据库&应用场景

顾名思义， 就是存储与时间相关的数据， 是在时间上分布的一系列值。  
例如股票价格， 随时间的温度变化等等。 而在物联网中， 数据网网是以时间维度度量的。 除了时间和值这个维度， 携带的还可能有其他部分， 比如温度测量可能会携带是哪里的温度等等，因为不同的地方的温度或者由不同温度计采集上来的点没有直接的关联。 



### 时间序列处理
在对时间序列的数据有些操作是比较特别的， 在传统数据库可能是不存在的， 或者很难去实现

#### 降精度
时序数据在可视化上一般是一些点连成的线， 当时间越长， 能够取出的点越多，当我们取1年的时间甚至更长， 需要把精度降到一天或者一周，我们只选这一天或一周中的最大值或者最小值或者平均值作为这一天或一周的气温。 用算法或者把时序数据转换成精度比较低的时间序列以便于观察和理解它，这是在传统数据库里没有的一种方式。

#### 插值
比如说中间丢失了一个点，比较简单的方法是中间插一个值，常用的方法是线性插值，就是在时间轴上画一个直线中间的点就插出来了。


#### 其他操作
聚合


### 时序数据库对比
> 在选型中， 主要研究了两款时序数据库， opentsdb 和 influxdb， 当然还有其他时序数据库可供我们选择。

在企业中， 





### 时序数据库中遇到的问题？







---
一些关于时序数据库的分享： 

